{% extends '../base.html' %} {% load static %} {% block content %}
<style>
    #col-design {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #username {
        color: red;
    }

    #referenceid {
        color: cadetblue;
        font-size: large;
    }

    #referenceid:hover {
        text-decoration: underline;
    }

    #driver {
        color: green;
    }
</style>
<!--begin::Content-->
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
    <!--begin::Entry-->
    <div class="d-flex flex-column-fluid">
        <!--begin::Container-->
        <div class="container">
            <!--begin::Dashboard-->
            <!--begin::Row-->
            <div class="row">
                <div class="col-xl-12">
                    <!--begin::Nav Panel Widget 1-->
                    <div class="card card-custom gutter-b card-stretch card-shadowless">
                        <!--begin::Body-->
                        <div class="card-body p-0">
                            <!--begin::Nav Tabs-->
                            <ul class="dashboard-tabs nav nav-pills nav-danger row row-paddingless m-0 p-0 flex-column flex-sm-row"
                                role="tablist">
                                <!--begin::Item-->
                                <li class="nav-item d-flex col-sm flex-grow-1 flex-shrink-0 mr-3 mb-3 mb-lg-0">
                                    <a class="nav-link border py-10 d-flex flex-grow-1 rounded flex-column align-items-center"
                                        data-toggle="pill" href="#tab_forms_widget_1">
                                        <span class="nav-icon py-2 w-auto">
                                            <span class="svg-icon svg-icon-3x">
                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Home/Library.svg-->
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                    xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                                                    height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <rect x="0" y="0" width="24" height="24" />
                                                        <path
                                                            d="M5,3 L6,3 C6.55228475,3 7,3.44771525 7,4 L7,20 C7,20.5522847 6.55228475,21 6,21 L5,21 C4.44771525,21 4,20.5522847 4,20 L4,4 C4,3.44771525 4.44771525,3 5,3 Z M10,3 L11,3 C11.5522847,3 12,3.44771525 12,4 L12,20 C12,20.5522847 11.5522847,21 11,21 L10,21 C9.44771525,21 9,20.5522847 9,20 L9,4 C9,3.44771525 9.44771525,3 10,3 Z"
                                                            fill="#000000" />
                                                        <rect fill="#000000" opacity="0.3"
                                                            transform="translate(17.825568, 11.945519) rotate(-19.000000) translate(-17.825568, -11.945519)"
                                                            x="16.3255682" y="2.94551858" width="3" height="18"
                                                            rx="1" />
                                                    </g>
                                                </svg>
                                                <!--end::Svg Icon-->
                                            </span>
                                        </span>
                                        <span class="nav-text font-size-lg py-2 font-weight-bold text-center">Total
                                            <strong style="font-size: 20px;">{{monthly_delivery}}</strong> Deliveries in
                                            This
                                            Month</span>
                                    </a>
                                </li>
                                <!--end::Item-->
                                <!--begin::Item-->
                                <li class="nav-item d-flex col-sm flex-grow-1 flex-shrink-0 mr-3 mb-3 mb-lg-0">
                                    <a class="nav-link border py-10 d-flex flex-grow-1 rounded flex-column align-items-center"
                                        data-toggle="pill" href="#tab_forms_widget_2">
                                        <span class="nav-icon py-2 w-auto">
                                            <span class="svg-icon svg-icon-3x">
                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Layout/Layout-4-blocks.svg-->
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                    xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                                                    height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <rect x="0" y="0" width="24" height="24" />
                                                        <rect fill="#000000" x="4" y="4" width="7" height="7"
                                                            rx="1.5" />
                                                        <path
                                                            d="M5.5,13 L9.5,13 C10.3284271,13 11,13.6715729 11,14.5 L11,18.5 C11,19.3284271 10.3284271,20 9.5,20 L5.5,20 C4.67157288,20 4,19.3284271 4,18.5 L4,14.5 C4,13.6715729 4.67157288,13 5.5,13 Z M14.5,4 L18.5,4 C19.3284271,4 20,4.67157288 20,5.5 L20,9.5 C20,10.3284271 19.3284271,11 18.5,11 L14.5,11 C13.6715729,11 13,10.3284271 13,9.5 L13,5.5 C13,4.67157288 13.6715729,4 14.5,4 Z M14.5,13 L18.5,13 C19.3284271,13 20,13.6715729 20,14.5 L20,18.5 C20,19.3284271 19.3284271,20 18.5,20 L14.5,20 C13.6715729,20 13,19.3284271 13,18.5 L13,14.5 C13,13.6715729 13.6715729,13 14.5,13 Z"
                                                            fill="#000000" opacity="0.3" />
                                                    </g>
                                                </svg>
                                                <!--end::Svg Icon-->
                                            </span>
                                        </span>
                                        <span class="nav-text font-size-lg py-2 font-weight-bolder text-center">Total
                                            Merchant <strong style="font-size: 20px;">{{mer_length}}</strong></span>
                                    </a>
                                </li>
                                <!--end::Item-->
                                <!--begin::Item-->
                                <li class="nav-item d-flex col-sm flex-grow-1 flex-shrink-0 mr-0 mb-3 mb-lg-0">
                                    <a class="nav-link border py-10 d-flex flex-grow-1 rounded flex-column align-items-center"
                                        data-toggle="pill" href="#tab_forms_widget_5">
                                        <span class="nav-icon py-2 w-auto">
                                            <span class="svg-icon svg-icon-3x">
                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Group.svg-->
                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                    xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                                                    height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <polygon points="0 0 24 0 24 24 0 24" />
                                                        <path
                                                            d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z"
                                                            fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                                        <path
                                                            d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z"
                                                            fill="#000000" fill-rule="nonzero" />
                                                    </g>
                                                </svg>
                                                <!--end::Svg Icon-->
                                            </span>
                                        </span>
                                        <span class="nav-text font-size-lg py-2 font-weight-bolder text-center">Active
                                            Drivers <strong style="font-size: 20px;">{{driver_list}}</strong></span>
                                    </a>
                                </li>
                                <!--end::Item-->
                            </ul>
                            <!--end::Nav Tabs-->
                            <!--begin::Nav Content-->
                            <div class="tab-content m-0 p-0">
                                <div class="tab-pane active" id="forms_widget_tab_1" role="tabpanel">
                                </div>
                                <div class="tab-pane" id="forms_widget_tab_2" role="tabpanel"></div>
                                <div class="tab-pane" id="forms_widget_tab_3" role="tabpanel"></div>
                                <div class="tab-pane" id="forms_widget_tab_4" role="tabpanel"></div>
                                <div class="tab-pane" id="forms_widget_tab_6" role="tabpanel"></div>
                            </div>
                            <!--end::Nav Content-->
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--begin::Nav Panel Widget 1-->
                </div>
            </div>
            <!--end::Row-->
            <!--begin::Row-->
            <div class="row">
                <div class="col-xl-8">
                    <!--begin::Charts Widget 2-->
                    <div class="card card-custom bg-gray-100 gutter-b card-stretch card-shadowless">
                        <!--begin::Header-->
                        <div class="card-header h-auto border-0">
                            <!--begin::Title-->
                            <div class="card-title py-5">
                                <h3 class="card-label">
                                    <span class="d-block text-dark font-weight-bolder">Monthly Report</span>
                                </h3>
                            </div>
                            <!--end::Title-->
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body">
                            <!--begin::Chart-->
                            <canvas id="admin_chart"></canvas>
                            <!--end::Chart-->
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Charts Widget 2-->
                </div>
                <div class="col-xl-4">
                    <!--begin::List Widget 2-->
                    <div class="card card-custom bg-light-success gutter-b card-stretch card-shadowless">
                        <!--begin::Header-->
                        <div class="card-header border-0">
                            <h3 class="card-title font-weight-bolder text-info">Client List</h3>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2" style="overflow-y: scroll; height:400px;">
                            <!--begin::Item-->
                            {%for detail in client_list%}
                            <div class="d-flex align-items-center mb-10">
                                <!--begin::Symbol-->
                                <div class="symbol symbol-40 symbol-light-white mr-5">
                                    <div class="symbol-label">
                                        {% if detail.user_pic %}
                                        <img src="{{detail.user_pic.url}}" class="h-75 w-75 align-self-center" alt="" />
                                        {%else%}
                                        <img src="" class="h-75 align-self-end" alt="" /> {%endif%}
                                    </div>
                                </div>
                                <!--end::Symbol-->
                                <!--begin::Text-->
                                <div class="d-flex flex-column font-weight-bold">
                                    <a href="{%url 'profile_visits' detail.id%}"
                                        class="text-dark text-hover-primary mb-1 font-size-lg">{{detail.username}}</a>
                                    <span class="text-muted">{{detail.contact}}</span>
                                </div>
                                <!--end::Text-->
                            </div>
                            {%endfor%}
                            <!--end::Item-->
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::List Widget 2-->
                </div>
            </div>
            <!--end::Row-->
            <!--begin::Row-->
            <div class="row">
                <div class="col-lg-4">
                    <!--begin::List Widget 3-->
                    <div class="card card-custom bg-light-info gutter-b card-stretch card-shadowless">
                        <!--begin::Header-->
                        <div class="card-header border-0">
                            <h3 class="card-title font-weight-bolder text-info">Merchant List</h3>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2" style="overflow-y: scroll; height:400px;">
                            <!--begin::Item-->
                            {%for detail in merchant_list%}
                            <div class="d-flex align-items-center mb-10">
                                <!--begin::Symbol-->
                                <div class="symbol symbol-40 symbol-light-white mr-5">
                                    <div class="symbol-label">
                                        {% if detail.user_pic %}
                                        <img src="{{detail.user_pic.url}}" class="h-75 w-75 align-self-center" alt="" />
                                        {%else%}
                                        <img src="" class="h-75 align-self-end" alt="" /> {%endif%}
                                    </div>
                                </div>
                                <!--end::Symbol-->
                                <!--begin::Text-->
                                <div class="d-flex flex-column font-weight-bold">
                                    <a href="{%url 'profile_visits' detail.id%}"
                                        class="text-dark text-hover-primary mb-1 font-size-lg">{{detail.username}}</a>
                                    <span class="text-muted">{{detail.contact}}</span>
                                </div>
                                <!--end::Text-->
                            </div>
                            {%endfor%}
                            <!--end::Item-->

                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::List Widget 3-->
                </div>
                <div class="col-lg-4">
                    <!--begin::List Widget 3-->
                    <div class="card card-custom bg-light-warning gutter-b card-stretch card-shadowless">
                        <!--begin::Header-->
                        <div class="card-header border-0">
                            <h3 class="card-title font-weight-bolder text-info">Client Order List</h3>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2" style="overflow-y: scroll; height:400px;">
                            <!--begin::Item-->
                            {%for detail in order_list%}
                            <div class="d-flex align-items-center mb-10">
                                <!--begin::Symbol-->
                                <div class="symbol symbol-40 symbol-light-white mr-5">
                                    <div class="symbol-label">
                                        {% if detail.user_pic %}
                                        <img src="{{detail.user.user_pic.url}}" class="h-75 w-75 align-self-center" alt="" />
                                        {%else%}
                                        <img src="" class="h-75 align-self-end" alt="" /> {%endif%}
                                    </div>
                                </div>
                                <!--end::Symbol-->
                                <!--begin::Text-->
                                <div class="d-flex flex-column font-weight-bold">
                                    <a href="#"
                                        class="text-dark text-hover-primary mb-1 font-size-lg">{{detail.receiver}}</a>
                                    <span class="text-muted">{{detail.priority}}</span>

                                </div>
                                <!--end::Text-->
                            </div>
                            {%endfor%}
                            <!--end::Item-->
                            <!--begin::Item-->

                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::List Widget 3-->
                </div>
                <div class="col-lg-4">
                    <!--begin::List Widget 3-->
                    <div class="card card-custom bg-light-dark gutter-b card-stretch card-shadowless">
                        <!--begin::Header-->
                        <div class="card-header border-0">
                            <h3 class="card-title font-weight-bolder text-info">Delivery Man List</h3>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2" style="overflow-y: scroll; height:400px;">
                            <!--begin::Item-->
                            {%for detail in deliveryman_list%}
                            <div class="d-flex align-items-center mb-10">
                                <!--begin::Symbol-->
                                <div class="symbol symbol-40 symbol-light-white mr-5">
                                    <div class="symbol-label">
                                        {% if detail.user_pic %}
                                        <img src="{{detail.user_pic.url}}" class="h-75 w-75 align-self-center" alt="" />
                                        {%else%}
                                        <img src="" class="h-75 align-self-end" alt="" /> {%endif%}
                                    </div>
                                </div>
                                <!--end::Symbol-->
                                <!--begin::Text-->
                                <div class="d-flex flex-column font-weight-bold">
                                    <a href="{%url 'profile_visits' detail.id%}"
                                        class="text-dark text-hover-primary mb-1 font-size-lg">{{detail.username}}</a>
                                    <span class="text-muted">{{detail.contact}}</span>
                                </div>
                                <!--end::Text-->
                            </div>
                            {%endfor%}

                            <!--end::Item-->
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::List Widget 3-->
                </div>
            </div>
            <!--end::Row-->
            <!--begin::Row-->
            <div class="row">
                <div class="col-xl-8">
                    <!--begin::Advance Table Widget 1-->
                    <div class="card card-custom card-stretch gutter-b card-shadowless bg-light">
                        <!--begin::Header-->
                        <div class="card-header border-0 py-5">
                            <h3 class="card-title align-items-start flex-column">
                                <span class="card-label font-weight-bolder text-dark">Agents
                                    Stats</span>
                                <span class="text-muted mt-3 font-weight-bold font-size-sm">Total Collected Amount-
                                    {{agents_cash_total}}</span>
                            </h3>
                            <div class="card-toolbar">
                                Total Delivered- {{total_complete_deliveries_agent}}
                            </div>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body py-0">
                            <!--begin::Table-->
                            <div class="table-responsive">
                                <div id="agent_stat" style="overflow-y: scroll; height: 300px;">

                                </div>
                            </div>
                            <!--end::Table-->
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Advance Table Widget 1-->
                </div>
                <div class="col-xl-4">
                    <!--begin::List Widget 7-->
                    <div class="card card-custom card-stretch gutter-b card-shadowless bg-light-dark">
                        <!--begin::Header-->
                        <div class="card-header border-0">
                            <h3 class="card-title font-weight-bolder text-dark">Cash Collections</h3>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-0" style="overflow-y: scroll; height: 300px;">
                            <!--begin::Item-->
                            {% for k, v in cash_col.items %}
                            <div class="d-flex align-items-center flex-wrap mb-8">
                                <!--begin::Symbol-->
                                <div class="symbol symbol-50 symbol-light mr-5">
                                    <span class="symbol-label">
                                        {% if k.user_pic %}
                                        <img src="{{k.user_pic.url}}" class="h-50 align-self-center"
                                            alt="Cash Collector" />
                                        {% else %}
                                        <img src="https://library.kissclipart.com/20180924/fvw/kissclipart-young-male-icon-clipart-computer-icons-f5830290579b98d9.png"
                                            class="h-50 align-self-center" alt="Cash Collector" />
                                        {%endif%}
                                        <img src="assets/media/svg/misc/006-plurk.svg" class="h-50 align-self-center"
                                            alt="" />
                                    </span>
                                </div>
                                <!--end::Symbol-->
                                <!--begin::Text-->
                                <div class="d-flex flex-column flex-grow-1 mr-2">
                                    <a href="#"
                                        class="font-weight-bold text-dark-75 text-hover-primary font-size-lg mb-1">{{k.first_name}}
                                        {{k.last_name}}</a>
                                    <span class="text-muted font-weight-bold">{{k.contact}}</span>
                                </div>
                                <!--end::Text-->
                                <span
                                    class="label label-xl label-light label-inline my-lg-0 my-2 text-dark-50 font-weight-bolder">+{{v}}&#2547;</span>
                            </div>
                            <!--end::Item-->
                            {% endfor %}
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::List Widget 7-->
                </div>
            </div>
            <!--end::Row-->
            <!--end::Dashboard-->
        </div>
        <!--end::Container-->
    </div>
    <!--end::Entry-->
</div>
<!--end::Content-->

<script>
    setInterval(function () {
        $.ajax({
            method: "GET",
            url: "/agents/stats/dashboard/",
            success: function (data) {
                $("#agent_stat").empty();
                $.each(data, function (key, value) {
                    var username = value.username.charAt(0).toUpperCase() + value.username.slice(1);
                    var reffer = value.reffer_id;
                    var orderDetail = "<a href='/see/agents/complete/detail/" + value.orderid + "/'>Detail</a>";
                    var deliveredBy = value.driver.charAt(0).toUpperCase() + value.driver.slice(1);
                    var driver = "<a href='/profile/visit/gddg447dgdg414ddg1d" + value.driverid + "57dgd5d/'>Detail</a>";
                    var deletion = "<a  href='/delete/agent/state/" + value.orderid + "/' class=' float-right'><i class='fa fa-trash' id='delete'></i></a>";
                    $("#agent_stat").append(
                        "<div class='container'><div class='row'><div class='col-md-12' id='col-design'>" + "<div id='username'>" + username + "</div> has received delivery with refference number " + "<strong id='referenceid'>" + reffer + "</strong>" + " Order was delivered by " + "<strong id='driver'>" + deliveredBy + "</strong> " + deletion + "<br>Delivery man " + driver + " || Order " + orderDetail + "<br><br></div></div></div>"
                    );
                })
            }
        })
    }, 1000)
</script>
<script>
    var ctx = document.getElementById('admin_chart').getContext('2d');
    var income = JSON.parse("{{income|escapejs}}");
    var cost = JSON.parse("{{cost|escapejs}}");

    var myChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['cost', 'income'],
            datasets: [{
                label: '# of Votes',
                data: [cost, income],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

</script>
{% endblock %}