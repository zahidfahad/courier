{% extends '../base.html' %} {% load static %} {% block content %}

<style>
    .checked {
        color: red;
    }

    .my-btn {
        background-color: inherit !important;
        border: 0 !important;
    }

    .glow-on-hover {
        width: 70px;
        height: 30px;
        border: none;
        outline: none;
        color: #fff;
        background: #111;
        cursor: pointer;
        position: relative;
        z-index: 0;
        border-radius: 10px;
    }

    .glow-on-hover:before {
        content: '';
        background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
        position: absolute;
        top: -2px;
        left: -2px;
        background-size: 400%;
        z-index: -1;
        filter: blur(5px);
        width: calc(100% + 4px);
        height: calc(100% + 4px);
        animation: glowing 20s linear infinite;
        opacity: 0;
        transition: opacity .3s ease-in-out;
        border-radius: 10px;
    }

    .glow-on-hover:active {
        color: #000
    }

    .glow-on-hover:active:after {
        background: transparent;
    }

    .glow-on-hover:hover:before {
        opacity: 1;
    }

    .glow-on-hover:after {
        z-index: -1;
        content: '';
        position: absolute;
        width: 100%;
        height: 100%;
        background: #111;
        left: 0;
        top: 0;
        border-radius: 10px;
    }

    @keyframes glowing {
        0% {
            background-position: 0 0;
        }

        50% {
            background-position: 400% 0;
        }

        100% {
            background-position: 0 0;
        }
    }

    #aid {
        background-color: white;
        color: black;
        border: 2px solid teal;
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 15px;
    }

    #aid:hover {
        background-color: teal;
        color: white;
    }

    #msg {
        height: 200px;
    }

    #msg:hover {
        border-color: teal;
    }

    @media (min-width: 992px) {
    .content {
        padding: 0;
    }
}

    @media (max-width: 991.98px) {
        .content {
            padding: 0;
        }
    }
    
</style>

<!--begin::Content-->
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
    <!--begin::Subheader-->
    <div class="subheader py-3 py-lg-8 subheader-transparent" id="kt_subheader">
        <div class="container d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
            <!--begin::Info-->
            <div class="d-flex align-items-center mr-1">
                <!--begin::Page Heading-->
                <div class="d-flex align-items-baseline flex-wrap mr-5">
                    <!--begin::Page Title-->
                    <h2 class="d-flex align-items-center text-dark font-weight-bold my-1 mr-3">
                        <a href="{%url 'change_email' %}" id='aid'>Change Email</a>
                    </h2>
                    <!--end::Page Title-->
                    <!--begin::Breadcrumb-->

                    <!--end::Breadcrumb-->
                </div>
                <!--end::Page Heading-->
            </div>
            <!--end::Info-->
            <!--begin::Toolbar-->
            <div class="d-flex align-items-center flex-wrap">
                <!--begin::Button-->
                <button class="btn button-color btn-fixed-height font-weight-bold px-2 px-lg-5 mr-2" id="reffer_button"
                    onclick="reffer()">
                    <span class="svg-icon svg-icon-lg">
                        <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Add-user.svg-->
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px"
                            height="24px" viewBox="0 0 24 24" version="1.1">
                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                <polygon points="0 0 24 0 24 24 0 24" />
                                <path
                                    d="M18,8 L16,8 C15.4477153,8 15,7.55228475 15,7 C15,6.44771525 15.4477153,6 16,6 L18,6 L18,4 C18,3.44771525 18.4477153,3 19,3 C19.5522847,3 20,3.44771525 20,4 L20,6 L22,6 C22.5522847,6 23,6.44771525 23,7 C23,7.55228475 22.5522847,8 22,8 L20,8 L20,10 C20,10.5522847 19.5522847,11 19,11 C18.4477153,11 18,10.5522847 18,10 L18,8 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z"
                                    fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                <path
                                    d="M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z"
                                    fill="#000000" fill-rule="nonzero" />
                            </g>
                        </svg>
                        <!--end::Svg Icon-->
                    </span>
                    <span class="d-none d-md-inline">Refer a Friend</span>
                </button>
                <!--end::Button-->
                <!--begin::Dropdown-->
                <a href="{%url 'edit_profile_driver' id%}" class="btn btn-danger">Edit Profile</a>
                <!--end::Dropdown-->
                <!--begin::Button-->

                <!--end::Button-->
            </div>
            <!--end::Toolbar-->
        </div>
    </div>
    <!--end::Subheader-->
    <!--begin::Entry-->
    <div class="d-flex flex-column-fluid">
        <!--begin::Container-->
        <div class="container">
            <!--begin::Card-->
            <div class="card card-custom gutter-b">
                <div class="card-body">
                    <!--begin::Details-->
                    {%for detail in user%}
                    <div class="d-flex mb-9">
                        <!--begin: Pic-->
                        <div class="flex-shrink-0 mr-7 mt-lg-0 mt-3">
                            <div class="symbol symbol-50 symbol-lg-120">
                                <img src="{{detail.user_pic.url}}" alt="image" />
                            </div>
                            <div class="symbol symbol-50 symbol-lg-120 symbol-primary d-none">
                                <span class="font-size-h3 symbol-label font-weight-boldest">JM</span>
                            </div>
                        </div>
                        <!--end::Pic-->
                        <!--begin::Info-->
                        <div class="flex-grow-1">
                            <!--begin::Title-->
                            <div class="d-flex justify-content-between flex-wrap mt-1">
                                <div class="d-flex mr-3">
                                    <a href="#"
                                        class="text-dark-75 text-hover-primary font-size-h5 font-weight-bold mr-3">{{detail.username}}</a>
                                    <a href="#">
                                        <i class="flaticon2-correct text-success font-size-h5"></i>
                                    </a>
                                </div>
                                
                                <div class="my-lg-0 my-3">
                                    {%for i in user%}
                                    {%if i.is_available is True %}
                                    <i class="fa fa-circle" aria-hidden="true" style="color: rgb(24, 104, 24);"></i>
                                    <a href="{% url 'available' i.id %}" class="btn btn-light-success">Available</a>
                                    {%endif%}
                                    {%if i.is_available is False %}
                                    <i class="fa fa-circle" aria-hidden="true" style="color: rgb(136, 22, 22);"></i>
                                    <a href="{% url 'available' i.id %}" class="btn btn-light-primary">Unavailable</a>
                                    {%endif%}
                                    {%endfor%}
                                </div>
                                
                            </div>
                            <!--end::Title-->
                            <!--begin::Content-->
                            <div class="d-flex flex-wrap justify-content-between mt-1">
                                <div class="d-flex flex-column flex-grow-1 pr-8">
                                    <div class="d-flex flex-wrap mb-4">
                                        <a href="#"
                                            class="text-dark-50 text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
                                            <i class="flaticon2-new-email mr-2 font-size-lg"></i>{{detail.email}}</a>
                                        <a href="#"
                                            class="text-dark-50 text-hover-primary font-weight-bold mr-lg-8 mr-5 mb-lg-0 mb-2">
                                            <i class="flaticon2-calendar-3 mr-2 font-size-lg"></i>Driver</a>
                                        <a href="#" class="text-dark-50 text-hover-primary font-weight-bold">
                                            <i class="flaticon2-placeholder mr-2 font-size-lg"></i>{{detail.city}}</a>
                                    </div>
                                    <span class="font-weight-bold text-dark-50">{{detail.quote}}</span>
                                    <span class="font-weight-bold text-dark-50">Team E-Courier</span>
                                </div>

                            </div>
                            <!--end::Content-->
                        </div>
                        {%endfor%}
                        <!--end::Info-->
                    </div>
                    <!--end::Details-->
                    <div class="separator separator-solid"></div>
                    <!--begin::Items-->
                    <div class="d-flex align-items-center flex-wrap mt-8">
                        <!--begin::Item-->
                        <div class="d-flex align-items-center flex-lg-fill mr-5 mb-2">
                            <span class="mr-4">
                                <i class="fa fa-star"></i>
                            </span>
                            <div class="d-flex flex-column text-dark-75">
                                <span class="font-weight-bolder font-size-sm">Rate</span>
                                <span class="font-weight-bolder font-size-h5">
                                    <span class="text-dark-50 font-weight-bold">Average Rating</span>
                                    {%for i in ratings%} {{i.avg_rating}} {%endfor%}
                                    <small>out of 5</small>
                                </span>

                            </div>
                        </div>
                        <!--begin::Item-->
                        <div class="d-flex align-items-center flex-lg-fill mr-5 mb-2">
                            <span class="mr-4">
                                <i class="flaticon-confetti display-4 text-muted font-weight-bold"></i>
                            </span>
                            <div class="d-flex flex-column text-dark-75">
                                <span class="font-weight-bolder font-size-sm">Total</span>
                                <span class="font-weight-bolder font-size-h5">
                                    <span class="text-dark-50 font-weight-bold">Rated </span> {%for i in ratings%}
                                    {{ i.count|floatformat }} {%endfor%} times
                                </span>
                            </div>
                        </div>
                        <!--end::Item-->
                    </div>
                    <!--begin::Items-->
                </div>
            </div>
            <!--end::Card-->
            <!--begin::Row-->
            {% if request.user.id == id %}
            <div class="row">
                <div class="col-lg-8">
                    <!--begin::Advance Table Widget 2-->
                    <div class="card card-custom card-stretch gutter-b">
                        <!--begin::Header-->
                        <div class="card-header border-0 pt-5">
                            <h3 class="card-title align-items-start flex-column">
                                <span class="card-label font-weight-bolder text-dark">
                                    Delivery reports</span>

                            </h3>
                            <div class="card-toolbar">
                                <ul class="nav nav-pills nav-pills-sm nav-dark-75">
                                    <li class="nav-item">
                                        <button class="btn btn-success" onclick="daily()" id="bt1day"
                                            style="background-color: transparent; color: black;">Day</button>
                                    </li>

                                    <li class="nav-item">
                                        <button class="btn btn-success" style="background-color: #1BC5BD; color: white;"
                                            onclick="monthly()" id="bt2month">Month</button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2 pb-0 mt-n3">
                            <div class="tab-content mt-5" id="myTabTables11">
                                <div class="row">
                                    <div class="col-md-3">
                                        <strong>Todays Amount- {{daily_amount}}</strong>
                                    </div>
                                    <div class="col-md-4 offset-md-5">
                                        <strong>Todays Deliveries- {{daily_dv_sc}}<small>(completed)</small></strong>
                                    </div>
                                </div>
                                <!--begin::Tap pane-->
                                <div class="tab-pane fade show active" id="kt_tab_pane_11_3" role="tabpanel"
                                    aria-labelledby="kt_tab_pane_11_3" style="overflow-y: scroll; height: 350px;">
                                    <!--begin::Table-->
                                    <!-- monthly report -->
                                    <div class="table-responsive" style="display: none;" id="monthbtn">
                                        <table class="table table-striped custom-table">
                                            <tbody>
                                                <tr>
                                                    <th>Receiver</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                    <th>Action</th>
                                                </tr>
                                                {% for entry in monthly_order %}
                                                <tr style="background-color: transparent;">
                                                    <td>
                                                        <a href="#"
                                                            class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg">
                                                            {{entry.receiver}}
                                                        </a>
                                                        <div>
                                                            <span class="font-weight-bolder">Phone:</span>
                                                            <a class="text-muted font-weight-bold text-hover-primary"
                                                                href="#">{{entry.receiver_Contact}}</a>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <span
                                                            class="text-dark-75 font-weight-bolder d-block font-size-lg">&#2547;
                                                            {{entry.amount}}</span> {%if entry.paid == True %}
                                                        <span class="text-muted font-weight-bold">Paid</span> {%else%}
                                                        <span class="text-muted font-weight-bold">Due</span> {%endif%}
                                                    </td>
                                                    <td>
                                                        <span
                                                            class="label label-lg label-light-primary label-inline">{{entry.delivery_Status}}</span>
                                                    </td>
                                                    <td>
                                                        <a href="{% url 'order_details' entry.id %}"
                                                            class="btn btn-icon btn-light btn-hover-primary btn-sm mx-3">
                                                            <i
                                                                class="fas fa-clipboard-list text-hover-primary mr-2"></i></a>

                                                        {% if not entry.delivery_Status == 'Complete' %}
                                                        <a href="{% url 'order_update' entry.id %}"
                                                            class="btn btn-icon btn-light btn-hover-primary btn-sm mx-3">
                                                            <span class="svg-icon svg-icon-md svg-icon-primary">
                                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Write.svg-->
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                    xmlns:xlink="http://www.w3.org/1999/xlink"
                                                                    width="24px" height="24px" viewBox="0 0 24 24"
                                                                    version="1.1">
                                                                    <g stroke="none" stroke-width="1" fill="none"
                                                                        fill-rule="evenodd">
                                                                        <rect x="0" y="0" width="24" height="24" />
                                                                        <path
                                                                            d="M12.2674799,18.2323597 L12.0084872,5.45852451 C12.0004303,5.06114792 12.1504154,4.6768183 12.4255037,4.38993949 L15.0030167,1.70195304 L17.5910752,4.40093695 C17.8599071,4.6812911 18.0095067,5.05499603 18.0083938,5.44341307 L17.9718262,18.2062508 C17.9694575,19.0329966 17.2985816,19.701953 16.4718324,19.701953 L13.7671717,19.701953 C12.9505952,19.701953 12.2840328,19.0487684 12.2674799,18.2323597 Z"
                                                                            fill="#000000" fill-rule="nonzero"
                                                                            transform="translate(14.701953, 10.701953) rotate(-135.000000) translate(-14.701953, -10.701953)" />
                                                                        <path
                                                                            d="M12.9,2 C13.4522847,2 13.9,2.44771525 13.9,3 C13.9,3.55228475 13.4522847,4 12.9,4 L6,4 C4.8954305,4 4,4.8954305 4,6 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,13 C20,12.4477153 20.4477153,12 21,12 C21.5522847,12 22,12.4477153 22,13 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,6 C2,3.790861 3.790861,2 6,2 L12.9,2 Z"
                                                                            fill="#000000" fill-rule="nonzero"
                                                                            opacity="0.3" />
                                                                    </g>
                                                                </svg>
                                                                <!--end::Svg Icon-->
                                                            </span>
                                                        </a>
                                                        {%endif%}
                                                    </td>
                                                </tr>
                                                {% endfor%}
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- monthly report ends -->

                                    <!-- for daily reports -->
                                    <div class="table-responsive" id="daybtn">
                                        <table class="table table-striped custom-table">
                                            <tbody>
                                                <tr>
                                                    <th>Receiver</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                    <th>Action</th>
                                                </tr>
                                                {% for entry in daily_deliveries %}
                                                <tr>

                                                    <td>
                                                        <a href="#"
                                                            class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg">
                                                            {{entry.receiver}}
                                                        </a>
                                                        <div>
                                                            <span class="font-weight-bolder">Phone:</span>
                                                            <a class="text-muted font-weight-bold text-hover-primary"
                                                                href="#">{{entry.receiver_Contact}}</a>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <span
                                                            class="text-dark-75 font-weight-bolder d-block font-size-lg">&#2547;
                                                            {{entry.amount}}</span> {%if entry.paid == True %}
                                                        <span class="text-muted font-weight-bold">Paid</span> {%else%}
                                                        <span class="text-muted font-weight-bold">Due</span> {%endif%}
                                                    </td>
                                                    <td>
                                                        <span
                                                            class="label label-lg label-light-primary label-inline">{{entry.delivery_Status}}</span>
                                                    </td>
                                                    <td>
                                                        <a href="{% url 'order_details' entry.id %}"
                                                            class="btn btn-icon btn-light btn-hover-primary btn-sm mx-3">
                                                            <i
                                                                class="fas fa-clipboard-list text-hover-primary mr-2"></i></a>

                                                        {% if not entry.delivery_Status == 'Complete' %}
                                                        <a href="{% url 'order_update' entry.id %}"
                                                            class="btn btn-icon btn-light btn-hover-primary btn-sm mx-3">
                                                            <span class="svg-icon svg-icon-md svg-icon-primary">
                                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Write.svg-->
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                    xmlns:xlink="http://www.w3.org/1999/xlink"
                                                                    width="24px" height="24px" viewBox="0 0 24 24"
                                                                    version="1.1">
                                                                    <g stroke="none" stroke-width="1" fill="none"
                                                                        fill-rule="evenodd">
                                                                        <rect x="0" y="0" width="24" height="24" />
                                                                        <path
                                                                            d="M12.2674799,18.2323597 L12.0084872,5.45852451 C12.0004303,5.06114792 12.1504154,4.6768183 12.4255037,4.38993949 L15.0030167,1.70195304 L17.5910752,4.40093695 C17.8599071,4.6812911 18.0095067,5.05499603 18.0083938,5.44341307 L17.9718262,18.2062508 C17.9694575,19.0329966 17.2985816,19.701953 16.4718324,19.701953 L13.7671717,19.701953 C12.9505952,19.701953 12.2840328,19.0487684 12.2674799,18.2323597 Z"
                                                                            fill="#000000" fill-rule="nonzero"
                                                                            transform="translate(14.701953, 10.701953) rotate(-135.000000) translate(-14.701953, -10.701953)" />
                                                                        <path
                                                                            d="M12.9,2 C13.4522847,2 13.9,2.44771525 13.9,3 C13.9,3.55228475 13.4522847,4 12.9,4 L6,4 C4.8954305,4 4,4.8954305 4,6 L4,18 C4,19.1045695 4.8954305,20 6,20 L18,20 C19.1045695,20 20,19.1045695 20,18 L20,13 C20,12.4477153 20.4477153,12 21,12 C21.5522847,12 22,12.4477153 22,13 L22,18 C22,20.209139 20.209139,22 18,22 L6,22 C3.790861,22 2,20.209139 2,18 L2,6 C2,3.790861 3.790861,2 6,2 L12.9,2 Z"
                                                                            fill="#000000" fill-rule="nonzero"
                                                                            opacity="0.3" />
                                                                    </g>
                                                                </svg>
                                                                <!--end::Svg Icon-->
                                                            </span>
                                                        </a>
                                                        {%endif%}
                                                    </td>
                                                </tr>
                                                {% endfor%}
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- ending daily reports -->
                                    <!--end::Table-->
                                </div>
                                <!--end::Tap pane-->
                            </div>
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Advance Table Widget 2-->
                </div>
                <div class="col-lg-4">
                    <!--begin::Mixed Widget 14-->
                    <div class="card card-custom card-stretch gutter-b" style="height: 500px; ">
                        <!--begin::Header-->
                        <div class="card-header border-0 pt-5">
                            {% if not request.user.is_driver %}
                            <h3 class="card-title font-weight-bolder">Leave a message. . .</h3>
                            {%else%}
                            <h3 class="card-title font-weight-bolder">Your review messages</h3>
                            {%endif%}
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body d-flex flex-column" style="overflow-y: scroll; height:400px;">
                            {%if not request.user.is_driver%}
                            <form method="post" action="{%url 'user_msg' id%}" id="ajax-post">
                                {% csrf_token %}
                                <textarea class="md-textarea form-control" id="msg" name="msg"
                                    placeholder="type here .." required></textarea>
                                <br> <br>
                                <button class="glow-on-hover" type="submit">Send</button>
                            </form>
                            {%else%}
                            <div id="my_review_msg"></div>
                            {%endif%}
                        </div>
                        {% if not request.user.is_driver%}
                        <div class="card-body pt-2 pb-0 mt-n3">
                            {%for i in ratings%}
                            <i class="fa fa-star"></i> Rate this user <br>
                            <br>
                            <form style="display: block!important;" class="rate-form" action="" method="POST"
                                id={{i.id}}>
                                {% csrf_token %}
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="first"></button>
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="second"></button>
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="third"></button>
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="fourth"></button>
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="fifth"></button>
                            </form>
                            {%endfor%}
                            <br>
                            <div id="confirm-box"></div>
                        </div>
                        {% endif %}
                        <!--end::Body-->
                    </div>
                    <!--end::Mixed Widget 14-->
                </div>
            </div>
            {%else%}
            <div class="row">
                <div class="col-lg-8">
                    <!--begin::Advance Table Widget 2-->
                    <div class="card card-custom card-stretch gutter-b">
                        <!--begin::Header-->
                        <div class="card-header border-0 pt-5">
                            <h3 class="card-title align-items-start flex-column">
                                <span class="card-label font-weight-bolder text-dark"><i class="fa fa-info"></i></span>

                                <span class="text-muted mt-3 font-weight-bold font-size-sm">Information</span>
                            </h3>
                            <div class="card-toolbar">
                                <ul class="nav nav-pills nav-pills-sm nav-dark-75">
                                    <li class="nav-item">
                                        <a class="nav-link py-2 px-4" data-toggle="tab"
                                            href="#kt_tab_pane_11_1">Deliveryman</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2 pb-0 mt-n3">
                            <div class="tab-content mt-5" id="myTabTables11">
                                <!--begin::Tap pane-->
                                <div class="table-responsive">
                                    <table class="table table-striped custom-table">
                                        <tbody>
                                            <tr>
                                                <th>Contact's</th>

                                                <th>Email</th>
                                            </tr>
                                            {%for i in user%}
                                            <tr>
                                                <td id="td1">
                                                    {{i.contact}}<br>{{i.contact2}}<br>{{i.contact3}}<br>{{i.contact4}}
                                                </td>
                                                <td id="td5">{{i.email}}</td>
                                            </tr>
                                            {%endfor%}
                                        </tbody>
                                    </table>
                                </div>
                                <table class="table table-striped custom-table">
                                    <tbody>
                                        <tr>
                                            <th>Address</th>
                                            <th>City</th>
                                        </tr>
                                        {%for i in user%}
                                        <tr>
                                            <td id="td1">{{i.address}}</td>
                                            <td id="td5">{{i.city}}</td>
                                        </tr>
                                        {%endfor%}
                                    </tbody>
                                </table>
                            </div>
                            <table class="table table-striped custom-table">
                                <tbody>
                                    <tr>
                                        <th>Delivery Success</th>
                                        <th>Pending Delivery</th>
                                        <th>Delivering</th>
                                    </tr>
                                    <tr>
                                        <td>{{complete_count}} <i class="fa fa-check"
                                                style="color: rgb(134, 233, 134)"></i>
                                        </td>
                                        <td>{{pending_count}} <i class="fas fa-times" style="color: red;"></i></td>
                                        <td>{{delivering_count}} <i class="fas fa-clock"
                                                style="color: rgb(26, 29, 27);"></i></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        {% if not request.user.is_delivery_man or not request.user.is_driver %}
                        <div class="card-body pt-2 pb-0 mt-n3">
                            {%for i in ratings%}
                            <i class="fa fa-star"></i> Rate this user <br>
                            <br>

                            <form style="display: block!important;" class="rate-form" action="" method="POST"
                                id={{i.id}}>
                                {% csrf_token %}
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="first"></button>
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="second"></button>
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="third"></button>
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="fourth"></button>
                                <button type="submit" class="fa fa-star fa-2x my-btn" id="fifth"></button>
                            </form>

                            {%endfor%}
                            <br>
                            <div id="confirm-box"></div>
                        </div>
                        {% endif %}
                        <!--end::Body-->
                    </div>

                    <!--end::Advance Table Widget 2-->
                </div>
                <div class="col-lg-4">
                    <!--begin::Mixed Widget 14-->
                    <div class="card card-custom card-stretch gutter-b" style="height: 500px; ">
                        <!--begin::Header-->
                        <div class="card-header border-0 pt-5">
                            {%if not request.user.is_delivery_man%}
                            <h3 class="card-title font-weight-bolder">Leave a message. . .</h3>
                            {%else%}
                            <h3 class="card-title font-weight-bolder">Your review messages</h3>
                            {%endif%}
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body d-flex flex-column" style="overflow-y: scroll; height:400px;">
                            {%if not request.user.is_delivery_man%}
                            <form method="post" action="{%url 'user_msg' id%}" id="ajax-post">
                                {% csrf_token %}
                                <textarea class="md-textarea form-control" id="msg" name="msg"
                                    placeholder="type here .." required></textarea>
                                <br> <br>
                                <button class="glow-on-hover" type="submit">Send</button>
                            </form>

                            {%else%}
                            <div id="my_review_msg"></div>
                            {%endif%}
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Mixed Widget 14-->
                </div>
            </div>
            {% endif %}
            <!--end::Row-->
            <!--begin::Row-->
            <div class="row">
                <div class="col-lg-6">
                    <!--begin::Charts Widget 4-->
                    <div class="card card-custom card-stretch gutter-b">
                        <!--begin::Header-->
                        <div class="card-header h-auto border-0">
                            <div class="card-title py-5">
                                <h3 class="card-label">
                                    <span class="d-block text-dark font-weight-bolder">Complain Box</span>
                                    <span class="d-block text-muted mt-2 font-size-sm">Dear user,<br> We always try our
                                        best to give the best service.If you feel something <br> needs to be fixed
                                        please feel free to leave a message.<br><br><strong>E-Courier</strong></span>
                                </h3>
                            </div>
                            <div class="card-toolbar">
                                <ul class="nav nav-pills nav-pills-sm nav-dark-75" role="tablist">
                                    <i class="fa fa-box"></i>
                                </ul>
                            </div>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        {%if request.user.is_driver%}
                        <div class="card-body">
                            <div class="table-responsive"><br>
                                <a href="#">Complain any issue</a> <br><br>
                                <form method="post" action="{% url 'complain_box' id %}" id="ajax-post">
                                    {%csrf_token%}
                                    <input class="w3-input" type="text" name="msg" id="complain" required></p><br>
                                    <button class="glow-on-hover" type="submit">Send</button>
                                </form>

                            </div>
                        </div>
                        {%else%}
                        <h1 style="margin-left: 1.5rem;">You can Complain From Your own profile</h1>
                        {%endif%}
                        <!--end::Body-->
                    </div>
                    <!--end::Charts Widget 4-->
                </div>
                <div class="col-lg-6">
                    <!--begin::List Widget 11-->
                    <div class="card card-custom card-stretch gutter-b">
                        <!--begin::Header-->
                        <div class="card-header border-0">
                            <h3 class="card-title font-weight-bolder text-dark">Manage Vehicle</h3>
                            <div class="card-toolbar">
                                <div class="dropdown dropdown-inline" data-toggle="tooltip" title="Quick actions"
                                    data-placement="left">
                                    <a href="#" class="btn btn-clean btn-hover-light-primary btn-sm btn-icon"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="ki ki-bold-more-ver"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-md dropdown-menu-right">
                                        <!--begin::Navigation-->
                                        <ul class="navi navi-hover py-5">
                                            <li class="navi-item">
                                                <a href="{%url 'vehicle_settings' id%}" class="navi-link">
                                                    <span class="navi-icon">
                                                        <i class="flaticon2-drop"></i>
                                                    </span>
                                                    <span class="navi-text">Edit Vehicle Settings</span>
                                                </a>
                                            </li>

                                        </ul>
                                        <!--end::Navigation-->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        {%for data in user%}
                        <div class="card-body pt-0">
                            <!--begin::Item-->
                            <div class="d-flex align-items-center mb-9 bg-light-warning rounded p-5">
                                <!--begin::Icon-->
                                <span class="svg-icon svg-icon-warning mr-5">
                                    <span class="svg-icon svg-icon-lg">
                                        <i class="fa fa-truck"></i>
                                    </span>
                                </span>
                                <!--end::Icon-->
                                <!--begin::Title-->
                                <div class="d-flex flex-column flex-grow-1 mr-2">
                                    <a href="#"
                                        class="font-weight-bold text-dark-75 text-hover-primary font-size-lg mb-1">{{data.vehicle_type}}</a>
                                    <span class="text-muted font-weight-bold">My Vehicle Type</span>
                                </div>
                                <!--end::Title-->
                                <!--begin::Lable-->
                                <span class="font-weight-bolder text-warning py-1 font-size-lg"></span>
                                <!--end::Lable-->
                            </div>

                            <!--begin::Item-->
                            <div class="d-flex align-items-center bg-light-danger rounded p-5 mb-9">
                                <!--begin::Icon-->
                                <span class="svg-icon svg-icon-danger mr-5">
                                    <span class="svg-icon svg-icon-lg">
                                        <i class="fa fa-user"></i>
                                    </span>
                                </span>
                                <!--end::Icon-->
                                <!--begin::Title-->
                                <div class="d-flex flex-column flex-grow-1 mr-2">
                                    {%if data.driving_license%}
                                    <img height="90px" width="90px" src="{{data.driving_license.url}}"
                                        style="border-radius: 5px;">
                                    <span class="text-muted font-weight-bold">Driving License</span> {%else%}
                                    <span class="text-muted font-weight-bold">Upload Your License</span> {%endif%}
                                </div>
                                <!--end::Title-->
                                <!--begin::Lable-->
                                <span class="font-weight-bolder text-danger py-1 font-size-lg"></span>
                                <!--end::Lable-->
                            </div>

                            <div class="d-flex align-items-center bg-light-danger rounded p-5 mb-9">
                                <!--begin::Icon-->
                                <span class="svg-icon svg-icon-danger mr-5">
                                    <span class="svg-icon svg-icon-lg">
                                        <i class="flaticon-network"></i>
                                    </span>
                                </span>
                                <!--end::Icon-->
                                <!--begin::Title-->
                                <div class="d-flex flex-column flex-grow-1 mr-2">
                                    <a href="#"
                                        class="font-weight-bold text-dark-75 text-hover-primary font-size-lg mb-1">{{data.vehicle_no}}</a>
                                    <span class="text-muted font-weight-bold">Vehicle number</span>
                                </div>
                                <!--end::Title-->
                                <!--begin::Lable-->
                                <span class="font-weight-bolder text-danger py-1 font-size-lg"></span>
                                <!--end::Lable-->
                            </div>
                            <!--end::Item-->
                            <!--begin::Item-->

                            <!--end::Item-->
                        </div>
                        {%endfor%}
                        <!--end::Body-->
                    </div>
                    <!--end::List Widget 11-->
                </div>
            </div>
            <!--end::Row-->
        </div>
        <!--end::Container-->
    </div>
    <!--end::Entry-->
</div>
<!--end::Content-->

<!--real time ratings -->
<script>
    const one = document.getElementById('first')
    const two = document.getElementById('second')
    const three = document.getElementById('third')
    const four = document.getElementById('fourth')
    const five = document.getElementById('fifth')

    // get the form, confirm-box and csrf token
    const form = document.querySelector('.rate-form')
    const confirmBox = document.getElementById('confirm-box')
    const csrf = document.getElementsByName('csrfmiddlewaretoken')

    const handleStarSelect = (size) => {
        const children = form.children
        console.log(children[0])
        for (let i = 0; i < children.length; i++) {
            if (i <= size) {
                children[i].classList.add('checked')
            } else {
                children[i].classList.remove('checked')
            }
        }
    }

    const handleSelect = (selection) => {
        switch (selection) {
            case 'first':
                {
                    handleStarSelect(1)
                    return
                }
            case 'second':
                {
                    handleStarSelect(2)
                    return
                }
            case 'third':
                {
                    handleStarSelect(3)
                    return
                }
            case 'fourth':
                {
                    handleStarSelect(4)
                    return
                }
            case 'fifth':
                {
                    handleStarSelect(5)
                    return
                }
            default:
                {
                    handleStarSelect(0)
                }
        }

    }

    const getNumericValue = (stringValue) => {
        let numericValue;
        if (stringValue === 'first') {
            numericValue = 1
        } else if (stringValue === 'second') {
            numericValue = 2
        } else if (stringValue === 'third') {
            numericValue = 3
        } else if (stringValue === 'fourth') {
            numericValue = 4
        } else if (stringValue === 'fifth') {
            numericValue = 5
        } else {
            numericValue = 0
        }
        return numericValue
    }

    if (one) {
        const arr = [one, two, three, four, five]

        arr.forEach(item => item.addEventListener('mouseover', (event) => {
            handleSelect(event.target.id)
        }))

        arr.forEach(item => item.addEventListener('click', (event) => {
            // value of the rating not numeric
            const val = event.target.id

            let isSubmit = false
            form.addEventListener('submit', e => {
                e.preventDefault()
                if (isSubmit) {
                    return
                }
                isSubmit = true
                // rate id
                const id = e.target.id
                // value of the rating translated into numeric
                const val_num = getNumericValue(val)

                $.ajax({
                    type: 'POST',
                    url: '/rate/',
                    data: {
                        'csrfmiddlewaretoken': csrf[0].value,
                        'el_id': id,
                        'val': val_num,
                    },
                    success: function (response) {
                        console.log(response)
                        confirmBox.innerHTML = `<strong>Successfully rated with ${response.rated_number} star</strong>`
                    },
                    error: function (error) {
                        console.log(error)
                        confirmBox.innerHTML = '<strong>Ups... something went wrong</strong>'
                    }
                })
            })
        }))
    }
</script>
<!-- end ratings -->

<!-- real time get msg -->
<script>
    setInterval(function () {
        $.ajax({
            method: "GET",
            url: "/get_complains",
            success: function (data) {
                console.log(data)
                $("#my_review_msg").empty();
                $.each(data, function (key, value) {
                    var a = value.Sender.charAt(0).toUpperCase() + value.Sender.slice(1);
                    var b = value.Msg;
                    var c = value.Sent.substring(0, 10)
                    var Read = value.Read;
                    console.log(data)
                    var del = "<a  href='/delete/" + value.MID + "/'>Delete</a>";

                    $("#my_review_msg").append(
                        "<div ClassName='container darker'>" + a + " <br> " + b + "<br>" + c + "<br><i class='fa fa-trash'></i>" + del + "<hr><br></div>"
                    );

                })
            }
        })

    }, 1000)
</script>
<!-- end msg -->


<!-- real time posting messages by zhf(zahid hassan fahad) -->
<script>
    $(function () {
        $("#ajax-post").submit(function (event) {
            event.preventDefault();
            var Form = $(this);
            var posting = $.post(Form.attr('action'), Form.serialize());
            posting.done(function (data) {
                console.log(data)
                // success msg by zhf
                Swal.fire("Message Sent", "Have a nice day !", "success");
            });
            posting.fail(function (data) {
                Swal.fire("Ups", "Something went wrong!", "failure");
            });
        });
    });
</script>
<!-- end msg -->

<!-- daily report zhf -->
<script>
    function daily() {

        var button1 = document.getElementById("bt1day");
        var button2 = document.getElementById("bt2month");

        if (button1.style.backgroundColor != "transparent") {
            button1.style.backgroundColor = "transparent"
            button2.style.backgroundColor = "#1BC5BD";
            button2.style.color = "white";
            button1.style.color = "black"
        } else {
            button1.style.backgroundColor = "transparent"
            button1.style.color = "black"
        }


        var x = document.getElementById("daybtn");
        var y = document.getElementById("monthbtn");

        if (x.style.display === "none") {
            x.style.display = "block";
            y.style.display = "none";
        } else {
            x.style.display = "flex";
        }
    }
</script>

<!--monthly report zhf -->
<script>
    function monthly() {

        var button1 = document.getElementById("bt1day");
        var button2 = document.getElementById("bt2month");

        if (button2.style.backgroundColor != "transparent") {
            button1.style.backgroundColor = "#1BC5BD";
            button1.style.color = "white";
            button2.style.backgroundColor = "transparent";
            button2.style.color = "black"
        } else {
            button2.style.backgroundColor = "transparent";
        }


        var x = document.getElementById("daybtn");
        var y = document.getElementById("monthbtn");

        if (y.style.display === "none") {
            y.style.display = "block";
            x.style.display = "none";
        } else {
            y.style.display = "flex";
        }
    }
</script>

{%endblock%}